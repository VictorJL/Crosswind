var title := stage.create_scene()

var init = fun[title](){

	auto window_size := core.video.window.get_size()

    auto main_camera := title.create_camera(window_size)
    title.set_camera("main_camera", main_camera)

    core.mixer.load_music("logo_bgm", core.filesystem.get_file_path("logo_bgm.ogg"))
    core.mixer.load_music("title_bgm", core.filesystem.get_file_path("title_bgm.ogg"))

    auto sega_logo := title.create_actor()


    var sega_init = fun[sega_logo](){
        sega_logo.add_model("sega_logo",
                        vec3(0.0f, 0.0f, 0.0f),
                        vec3(-100.0f * 640.0f/320.0f, -100.0f*480.0f/224.0f, 0.0f),
                        "sega_logo.json")
    }

    var sega_deinit = fun[sega_logo](){

    }

    var sega_logic  = fun[sega_logo](delta){

    }

    sega_logo.construct(sega_init, sega_deinit, sega_logic)

    title.add_actor("sega_logo", sega_logo)

    //sega_logo.init()
    sega_init()

    title.get_camera("main_camera").set_position(vec3(0.0f, 0.0f, 0.0f));
    core.video.window.set_clear_color(vec4(1.0f, 1.0f, 1.0f, 1.0f))

    title.get_actor("sega_logo").set_alpha(0.0f)
//  title.get_actor("team_logo").set_alpha(0.0f);
//  title.get_actor("title_background").set_alpha(0.0f);


    title.set_bool("sega_sound_ongoing", false)
    title.set_bool("title_sound_ongoing", false)
    title.set_float("sega_logo_duration", 8.0f)
    title.set_float("sega_logo_duration", 8.0f)
    title.set_float("time_count", 8.0f)
    title.set_int("phase", 0)

}

var deinit = fun[title](){
    
}

var logic  = fun[title](delta){

    var time := title.get_float("time_count")
    time += delta

    var phase = title.get_int("phase")

    if(phase == 0){
        var sega_logo_duration := title.get_float("sega_logo_duration")
        var sega_sound_ongoing := title.get_bool("sega_sound_ongoing")

        if(time <= sega_logo_duration){
            if(time <= 2.0f){
                
                var blending = sin(radians(time / 2.0f * 90.0f));
                title.get_actor("sega_logo").set_alpha(blending)

            } else if(!sega_sound_ongoing) {

                sega_sound_ongoing = true
                core.mixer.play_music("logo_bgm", 0)

            } else if(time >= 6.0f && time <= 8.0f){
                var time_range = 2.0f - (8.0f - time)
                var blending = sin(radians((time_range / 2.0f * 90.0f) + 90.0f));
                title.get_actor("sega_logo").set_alpha(blending);

                core.video.window.set_clear_color(vec4(blending, blending, blending, 1.0f));
            }
        } else {
            time = 0.0f;
            ++phase
        }

    } else if(phase == 1){
        var team_logo_duration := title.get_float("team_logo_duration")

        if(time <= team_logo_duration){
            auto blending = sin(radians(time / team_logo_duration * 180.0f))
         //   title.get_actor("team_logo").set_alpha(blending);
        } else {
            time = 0.0f;
            --phase
        }

    } else {

    }

}


title.construct(init, deinit, logic)

stage.add_scene("title", title)
stage.load_scene("title")